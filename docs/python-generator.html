<!DOCTYPE html>

<html>





<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>[파이썬] 제너레이터 - miintto.log</title>

  <meta name="description" content="일반적으로 파이썬에서 반복문을 사용하는 경우 파이썬 리스트에 담아 for 문을 사용해 실행하는 경우가 많습니다. 하지만 만약 반복하는 데이터의 양이 약 10만 개 정도 된다면 해당 데이터를 다 리스트에 집어넣는 건 너무 낭비가 큽니다. 이런 경우 프로그램이 좀 더 효율적으로 동작하...">

  <meta name="google-site-verification" content="wGN_mZVjgAC8sdItYCBTkSMwLrgNSWPY6sicU3MuSQw" />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lora:ital@1&display=swap">
  <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="https://miintto.github.io/docs/python-generator">
  <link rel="alternate" type="application/rss+xml" title="[파이썬] 제너레이터 - miintto.log" href="/feed.xml">

  <link rel="apple-touch-icon" href="/img/favicon-128.png">
  <link rel="shortcut icon" type="image/x-icon" href="/img/favicon.ico">
  <link rel="icon" type="image/x-icon" href="/img/favicon.ico">

  <meta prefix="og: http://ogp.me/ns#" property="og:site_name" content="miintto.log"/>
  <meta prefix="og: http://ogp.me/ns#" property="og:type" content="blog"/>
  <meta prefix="og: http://ogp.me/ns#" property="og:title" content="[파이썬] 제너레이터 - miintto.log"/>
  <meta prefix="og: http://ogp.me/ns#" property="og:description" content="일반적으로 파이썬에서 반복문을 사용하는 경우 파이썬 리스트에 담아 for 문을 사용해 실행하는 경우가 많습니다. 하지만 만약 반복하는 데이터의 양이 약 10만 개 정도 된다면 해당 데이터를 다 리스트에 집어넣는 건 너무 낭비가 큽니다. 이런 경우 프로그램이 좀 더 효율적으로 동작하..."/>
  <meta prefix="og: http://ogp.me/ns#" property="og:locale" content="ko_KR"/>
  <meta prefix="og: http://ogp.me/ns#" property="og:url" content="https://miintto.github.io/docs/python-generator"/>
  <meta prefix="og: http://ogp.me/ns#" property="og:image" content="/img/thumbnails/python.png">

</head>


<body>

  <!-- Navigation -->

<nav class="navbar" style="background-color: white;">

  <div class="navbar-content container">
    <a class="navbar-brand" href="/">miintto.log</a>
    <button class="navbar-button" id="toggleButton" type="button" data-toggle="collapse" aria-controls="navbarResponsive" aria-expanded="false">
      MENU
      <i class="fa fa-bars"></i>
    </button>
    <div class="navbar-nav" id="navbarResponsive" aria-hidden="true">
      <div class="nav-item">
        <a class="nav-link" href="/about">ABOUT</a>
      </div>
      <div class="nav-item">
        <a class="nav-link" href="/posts">POSTS</a>
      </div>
      <div class="nav-item">
        <a class="nav-link" href="/archive">ARCHIVES</a>
      </div>
    </div>
  </div>
</nav>


  <div class="article">
  <div class="article-wrapper">
    <div class="article-header">
      <div class="article-info">
        <h1>[파이썬] 제너레이터</h1>
        <div class="post-tags">
          <p>python</p><p>generator</p>
        </div>
        <div class="article-meta">
          2022.03.06 &middot; <span class="reading-time" title="Estimated read time">
  
   9 mins  read </span>

        </div>
      </div>
      <div class="article-banner"">
        <img src="/img/thumbnails/python.png">
      </div>
    </div>

    <div class="article-content">
      <aside>
  <div class="section-toc">
    <ul id="toc" class="section-nav">
<li class="toc-entry toc-h1"><a href="#1-반복문">1. 반복문</a>
<ul>
<li class="toc-entry toc-h2"><a href="#11-iterable">1.1 Iterable</a></li>
<li class="toc-entry toc-h2"><a href="#12-iterator">1.2 Iterator</a></li>
</ul>
</li>
<li class="toc-entry toc-h1"><a href="#2-generator-함수">2. Generator 함수</a></li>
<li class="toc-entry toc-h1"><a href="#3-yield-from">3. yield from</a></li>
<li class="toc-entry toc-h1"><a href="#4-conclusion">4. Conclusion</a></li>
</ul>
  </div>
</aside>


      <p>일반적으로 파이썬에서 반복문을 사용하는 경우 파이썬 리스트에 담아 for 문을 사용해 실행하는 경우가 많습니다.
하지만 만약 반복하는 데이터의 양이 약 10만 개 정도 된다면 해당 데이터를 다 리스트에 집어넣는 건 너무 낭비가 큽니다.
이런 경우 프로그램이 좀 더 효율적으로 동작하도록 generator를 사용할 수 있습니다.</p>

<hr />

<h1 id="1-반복문">1. 반복문</h1>

<h2 id="11-iterable">1.1 Iterable</h2>

<p><strong>Iterable</strong>은 반복 작업이 가능한 python 객체를 말합니다.
내부에 <code class="language-plaintext highlighter-rouge">__iter__</code> 메소드가 구현되어 있으며, 파이썬 구조체로는 <code class="language-plaintext highlighter-rouge">list</code>, <code class="language-plaintext highlighter-rouge">str</code>, <code class="language-plaintext highlighter-rouge">dict</code> 등의 객체가 해당됩니다.
쉽게 말해서 for 문으로 순차적으로 원소를 가져올 수 있는 객체는 모두 Iterable 객체라고 간주할 수 있습니다.</p>

<p>다음 객체들은 모두 Iterable 입니다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">collections.abc</span> <span class="kn">import</span> <span class="n">Iterable</span>

<span class="nf">isinstance</span><span class="p">(</span><span class="sh">"</span><span class="s">Hello</span><span class="sh">"</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">)</span>  <span class="c1"># str
# True
</span><span class="nf">isinstance</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">Iterable</span><span class="p">)</span>  <span class="c1"># list
# True
</span><span class="nf">isinstance</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">Iterable</span><span class="p">)</span>  <span class="c1"># tuple
# True
</span><span class="nf">isinstance</span><span class="p">({</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">},</span> <span class="n">Iterable</span><span class="p">)</span>  <span class="c1"># set
# True
</span><span class="nf">isinstance</span><span class="p">({</span><span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="sh">"</span><span class="s">b</span><span class="sh">"</span><span class="p">:</span> <span class="mi">2</span><span class="p">},</span> <span class="n">Iterable</span><span class="p">)</span>  <span class="c1"># dict
# True
</span><span class="nf">isinstance</span><span class="p">(</span><span class="nf">range</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">Iterable</span><span class="p">)</span>  <span class="c1"># range
# True
</span></code></pre></div></div>

<p>해당 객체들은 모두 내부에 <code class="language-plaintext highlighter-rouge">__iter__</code> 메소드가 구현되어 있어서 Iterator 객체를 생성할 수 있습니다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">iter</span><span class="p">(</span><span class="sh">"</span><span class="s">Hello</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># &lt;str_iterator object at 0x104b37d30&gt;
</span><span class="nf">iter</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="c1"># &lt;list_iterator object at 0x104b37910&gt;
</span><span class="nf">iter</span><span class="p">({</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">})</span>
<span class="c1"># &lt;set_iterator object at 0x104b8b8c0&gt;
</span><span class="nf">iter</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="c1"># &lt;tuple_iterator object at 0x104b37d30&gt;
</span><span class="nf">iter</span><span class="p">({</span><span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="sh">"</span><span class="s">b</span><span class="sh">"</span><span class="p">:</span> <span class="mi">2</span><span class="p">})</span>
<span class="c1">#.&lt;dict_keyiterator object at 0x104b9db70&gt;
</span></code></pre></div></div>

<h2 id="12-iterator">1.2 Iterator</h2>

<p><strong>Iterator</strong>는 iterable한 객체로부터 <code class="language-plaintext highlighter-rouge">iter()</code> 메소드로 생성됩니다. 내부에 <code class="language-plaintext highlighter-rouge">__iter__</code> 와 <code class="language-plaintext highlighter-rouge">__next__</code> 모두 구현되어 있어야 합니다.</p>

<p><code class="language-plaintext highlighter-rouge">__iter__</code> 메소드를 가지고 있으므로 Iterable 객체와 마찬가지로 값을 차례로 가져올 수 있습니다.
또한 <code class="language-plaintext highlighter-rouge">iter()</code>의 결과로 다시 Iterator를 반환할 수 있는데 그 반환값은 자기 자신입니다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">a</span> <span class="o">=</span> <span class="nf">iter</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
<span class="n">a</span>
<span class="c1"># &lt;list_iterator object at 0x104b64b20&gt;
</span><span class="nf">iter</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="c1"># &lt;list_iterator object at 0x104b64b20&gt;
</span></code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">__next__</code> 메소드는 더 이상 반환할 값이 없을 때까지 다음 원소를 반환합니다.
이때 Iterator는 내부적으로 순회하는 위치를 저장하고 있습니다.
반환한 위치를 기억하였다가 다음 호출이 있으면 그다음 값을 반환합니다.
또한 한 번 사용이 끝난 Iterator는 다시 재사용할 수 없습니다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">collections.abc</span> <span class="kn">import</span> <span class="n">Iterable</span>

<span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="nf">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">)</span>
<span class="c1"># True
</span>
<span class="n">it</span> <span class="o">=</span> <span class="nf">iter</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="nf">next</span><span class="p">(</span><span class="n">it</span><span class="p">)</span>
<span class="c1"># 1
</span><span class="nf">next</span><span class="p">(</span><span class="n">it</span><span class="p">)</span>
<span class="c1"># 2
</span><span class="nf">next</span><span class="p">(</span><span class="n">it</span><span class="p">)</span>
<span class="c1"># 3
</span><span class="nf">next</span><span class="p">(</span><span class="n">it</span><span class="p">)</span>
<span class="c1"># Traceback (most recent call last):
#   File "&lt;stdin&gt;", line 1, in &lt;module&gt;
# StopIteration
</span></code></pre></div></div>

<p>더 이상 가져올 값이 존재하지 않으면 <em>StopIteration</em> 예외를 발생시킵니다.</p>

<p>큰 범위에서 보면 Iterator는 Iterable의 특별한 케이스라고 할 수 있습니다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">issubclass</span><span class="p">(</span><span class="n">Iterator</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">)</span>
<span class="c1"># True
</span><span class="nf">issubclass</span><span class="p">(</span><span class="n">Iterable</span><span class="p">,</span> <span class="n">Iterator</span><span class="p">)</span>
<span class="c1"># False
</span></code></pre></div></div>

<hr />

<h1 id="2-generator-함수">2. Generator 함수</h1>

<p>제너레이터(generator) 함수는 반환 값으로 iterator 객체를 생성하는 함수입니다.
일반적으로 제너레이터라고 부르기도 하지만 제너레이터 함수가 반환하는 제너레이터 이터레이터(generator iterator)와 구분하기 위해서 여기서는 제너레이터 함수로 표기하겠습니다.</p>

<p>보통 <code class="language-plaintext highlighter-rouge">yield</code>를 포함하고 있는 함수는 모두 제너레이터(generator) 함수입니다.
일반적인 함수에서는 return 으로 결과값을 반환하지만, 제너레이터 함수는 yield를 사용합니다.
next 호출시마다 제너레이터 함수를 실행하여 yield로 선언한 값을 반환하는데 이때 제너레이터 함수는 다음 호출때까지 대기합니다.
다시 next로 제너레이터 함수에 요청이 들어오면 대기하던 제너레이터 함수는 실행을 이어갑니다.</p>

<p><img src="/img/posts/python-generator-flow.png" style="max-width:480px" /></p>

<p>제너레이터 함수에 반드시 iteration이 포함되어야 하는 건 아닙니다.
제너레이터 함수 자체가 반복자 인터페이스를 제공하기 때문입니다.
다음 코드를 보며 제너레이터 함수의 작동 과정을 살펴봅시다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">gen_123</span><span class="p">():</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">&gt;&gt;&gt; Start</span><span class="sh">'</span><span class="p">)</span>
    <span class="k">yield</span> <span class="mi">1</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">&gt;&gt;&gt; Continue</span><span class="sh">'</span><span class="p">)</span>
    <span class="k">yield</span> <span class="mi">2</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">&gt;&gt;&gt; End</span><span class="sh">'</span><span class="p">)</span>

<span class="n">gen_123</span>
<span class="c1"># &lt;function gen_123 at 0x7fa5c021bb80&gt;
</span>
<span class="nf">gen_123</span><span class="p">()</span>
<span class="c1"># &lt;generator object gen_123 at 0x7fa5c0230120&gt;
</span>
<span class="n">g</span> <span class="o">=</span> <span class="nf">gen_123</span><span class="p">()</span>
<span class="nf">next</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
<span class="c1"># &gt;&gt;&gt; Start
# 1
</span>
<span class="nf">next</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
<span class="c1"># &gt;&gt;&gt; Continue
# 2
</span>
<span class="nf">next</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
<span class="c1"># &gt;&gt;&gt; End
# Traceback (most recent call last):
#   File "&lt;stdin&gt;", line 1, in &lt;module&gt;
# StopIteration
</span></code></pre></div></div>

<p>제너레이터 함수는 <code class="language-plaintext highlighter-rouge">next</code> 호출 시마다 yield 로 선언한 값을 함수 밖으로 반환하고 대기합니다.
마지막까지 실행이 완료된 제너레이터 함수는 StopIteration을 발생시킵니다.</p>

<p>추가적으로 파이썬 버전 3.3부터는 제너레이터 함수에서 return 값을 선언할 수 있습니다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">gen</span><span class="p">():</span>
    <span class="k">yield</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="sh">'</span><span class="s">Returned In Generator!</span><span class="sh">'</span>

<span class="n">g</span> <span class="o">=</span> <span class="nf">gen</span><span class="p">()</span>

<span class="nf">next</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
<span class="c1"># 1
</span>
<span class="nf">next</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
<span class="c1"># Traceback (most recent call last):
#   File "&lt;stdin&gt;", line 1, in &lt;module&gt;
# StopIteration: Returned In Generator!
</span></code></pre></div></div>

<p>제너레이터의 return은 StopIteration을 발생시키고 반환값은 StopIteration의 에러 메시지로 할당됩니다.</p>

<hr />

<h1 id="3-yield-from">3. yield from</h1>

<p>제너레이터 내부에서 iteration을 하여 값을 반환하는 경우에는 <code class="language-plaintext highlighter-rouge">yield from</code>을 사용하면 더 간편하게 작성할 수 있습니다.
<code class="language-plaintext highlighter-rouge">yield from</code>은 iterable 인 객체만 지정할 수 있는데 또 다른 제너레이터를 호출할 수도 있습니다.
이렇게 제너레이터 안에서 또 다른 제너레이터를 호출하는 경우 <code class="language-plaintext highlighter-rouge">yield from</code>은 외부 제너레이터의 호출자와 내부 제너레이터를 연결하는 통로 역할을 하는데 해당 부분은 <strong>코루틴</strong>파트에서 자세히 다루겠습니다.</p>

<p>다음은 n 보다 작은 짝수를 모두 가져오는 코드입니다. 단순히 <code class="language-plaintext highlighter-rouge">yield from</code>이 작동하는걸 보여주기 위한 예시라 효율성과는 다소 거리가 멀게 작성되었습니다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">gen_even</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">i</span>

<span class="k">def</span> <span class="nf">delegate_generator</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">yield</span> <span class="k">from</span> <span class="nf">gen_even</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

<span class="nf">list</span><span class="p">(</span><span class="nf">delegate_generator</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span>
<span class="c1"># [0, 2, 4, 6, 8, 10, 12, 14, 16, 18]
</span></code></pre></div></div>

<p>상위 제너레이터 <code class="language-plaintext highlighter-rouge">delegate_generator</code> 에서 하위 제너레이터 <code class="language-plaintext highlighter-rouge">gen_even</code>을 호출하는 구조입니다.
하위 제너레이터에서 생성한 값을 상위 제너레이터로 전송하고 다시 <code class="language-plaintext highlighter-rouge">delegate_generator</code> 밖으로 전달됩니다.</p>

<hr />

<h1 id="4-conclusion">4. Conclusion</h1>

<p>제너레이터는 특정 값이 사용될 때까지 계산을 최대한 뒤로 미루는 <strong>lazy evaluation</strong> 방식으로 작동합니다.
선언 즉시 실행되는 것이 아닌 통해 호출될 때마다 연산 작업을 하게 되는데, 이런 방식으로 프로그래밍하는 경우 필요 없는 메모리 할당이 줄어들어 자원을 좀 더 효율적으로 사용할 수 있습니다.</p>

<hr />

<p>Reference</p>

<ul>
  <li>Luciano Ramalho, Fluent Python: Clear, Concise, and Effective Programming, 강권학, 한빛미디어, 2016-08-12</li>
  <li><a href="https://wiki.python.org/moin/Generators">Generators - Python Wiki</a></li>
  <li><a href="https://docs.python.org/ko/3/glossary.html#term-generator">Glossary - Python 3.10.2 documentation</a></li>
  <li><a href="https://niceman.tistory.com/136">파이썬(Python) - 이터레이터(Iterator) 설명 및 예제 소스 코드</a></li>
  <li><a href="https://shoark7.github.io/programming/python/iterable-iterator-generator-in-python">[Python] Iterable, Iterator 그리고 Generator</a></li>
  <li><a href="https://dojang.io/mod/page/view.php?id=2412">파이썬 코딩 도장</a></li>
  <li><a href="https://bluese05.tistory.com/56">python generator(제너레이터) 란 무엇인가</a></li>
</ul>


      <hr>

      <div id="disqus_thread"></div>
      <script>
          (function() {
          var d = document, s = d.createElement('script');
          s.src = 'https://miintto-github-io.disqus.com/embed.js';
          s.setAttribute('data-timestamp', +new Date());
          (d.head || d.body).appendChild(s);
          })();
      </script>
      <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

      <hr>

    </div>
  </div>
</div>


  <!-- Footer -->

<hr>

<footer>
  <div class="footer-content container">
    <p class="copyright text-muted">Copyright &copy; miintto 2024</p>
  </div>
</footer>


  <script src="https://use.fontawesome.com/releases/v5.15.3/js/all.js" crossorigin="anonymous"></script>
<script src="/assets/scripts.js"></script>


  <script src="/assets/vendor/miintto/js/toc.js"></script>



  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-XXXXXXXXX-X"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-XXXXXXXXX-X');
</script>



</body>

</html>
